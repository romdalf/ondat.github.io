<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.64.1" />

<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">

<link rel="alternate" type="application/rss&#43;xml" href="https://ondat.github.io/v1.x/docs/operations/external-etcd/index.xml">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/v1.x/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/v1.x/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/v1.x/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/v1.x/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/v1.x/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/v1.x/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/v1.x/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/v1.x/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/v1.x/favicons/android-192x192.png" sizes="192x192">

<title>Etcd | </title><meta property="og:title" content="Etcd" />
<meta property="og:description" content="Ondat Documentation" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://ondat.github.io/v1.x/docs/operations/external-etcd/" />

<meta itemprop="name" content="Etcd">
<meta itemprop="description" content="Ondat Documentation"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Etcd"/>
<meta name="twitter:description" content="Ondat Documentation"/>



<link rel="stylesheet"  href="/css/font-awesome.css?ver=5.4.1" type="text/css" media="all">



<link rel="preload" href="/v1.x/scss/main.min.f438d2b9796945cd1ecf249ee847e52b86c90b71a65473dd7df133307855c9d3.css" as="style">
<link href="/v1.x/scss/main.min.f438d2b9796945cd1ecf249ee847e52b86c90b71a65473dd7df133307855c9d3.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>




<script
  src="https://unpkg.com/lunr@2.3.8/lunr.min.js"
  integrity="sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY"
  crossorigin="anonymous"></script>


<script
  src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.js"
  integrity=""
  crossorigin="anonymous"></script>
<link href="/css/storageos.css" rel="stylesheet">
<script> (function(h,o,t,j,a,r){ h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)}; h._hjSettings={hjid:1025326,hjsv:6}; a=o.getElementsByTagName('head')[0]; r=o.createElement('script');r.async=1; r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv; a.appendChild(r); })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv='); </script>
<script src="/js/enable-link-tab.js"></script>


    <title>Etcd | </title>
  </head>
  <body class="td-section">
    <header>
      <div id="ondat-lp-header">
  <div class="ondat-lp-header-wrapper">
    <div class="ondat-lp-header-wrapper-left">
      <a class="navbar-brand" href="https://storageos.com">
        <svg width="135" height="24" viewBox="0 0 135 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)"><path d="M48.8466 13.2064V10.5821C48.8466 6.30695 51.1323 4.02124 55.8307 4.02124 60.6561 4.02124 62.7725 6.2223 62.7725 10.5821v2.6243C62.7725 17.4392 60.4868 19.7673 55.8307 19.7673 50.963 19.8096 48.8466 17.6085 48.8466 13.2064zM59.6826 10.5821C59.6826 8.0424 58.836 6.94188 55.8731 6.94188 52.9101 6.94188 52.0212 8.0424 52.0212 10.5821v2.6243C52.0212 15.7461 52.8678 16.8466 55.8731 16.8466 58.836 16.8466 59.6826 15.7884 59.6826 13.2064V10.5821z" fill="#1239b8"/><path d="M68.91 18.074C68.91 19.1745 68.6561 19.4285 67.5555 19.4285H67.1746C66.074 19.4285 65.8201 19.1745 65.8201 18.074V9.90469C65.8201 5.96818 68.0635 3.97876 72.4656 3.97876 77.0793 3.97876 79.0687 5.96818 79.0687 9.90469V18.074C79.0687 19.1745 78.8148 19.4285 77.7143 19.4285H77.3333C76.2328 19.4285 75.9788 19.1745 75.9788 18.074V9.90469C75.9788 7.83061 75.2169 6.94172 72.5079 6.94172 69.7989 6.94172 68.9947 7.87294 68.9947 9.90469V18.074H68.91z" fill="#1239b8"/><path d="M95.1534 13.5026C95.1534 17.6931 92.9947 19.7248 88.6772 19.7248 84.1481 19.7248 82.2433 17.5237 82.2433 13.5026V10.5396C82.2433 6.47613 84.0211 4.27507 88.5079 4.27507 91.0476 4.27507 92.6984 5.0793 93.4603 6.73009V1.31211C93.4603.719513 93.6296.592529 94.1799.592529H94.3492C94.9418.592529 95.0687.761841 95.0687 1.31211V13.5026H95.1534zM83.8941 13.5026C83.8941 16.7618 85.037 18.2433 88.7195 18.2433 92.3598 18.2433 93.5449 16.7618 93.5449 13.5026V10.4973C93.5449 7.23803 92.4021 5.75655 88.7195 5.75655 85.0793 5.75655 83.8941 7.23803 83.8941 10.4973v3.0053z" fill="#017efa"/><path d="M111.323 19.0053C111.323 19.5979 111.153 19.7249 110.603 19.7249H110.434C109.841 19.7249 109.714 19.5556 109.714 19.0053V17.3122C108.952 18.9207 107.259 19.7672 104.762 19.7672 100.275 19.7672 98.4974 17.5238 98.4974 13.5027V10.4974C98.4974 6.43388 100.317 4.27515 104.931 4.27515 109.206 4.27515 111.407 6.34922 111.407 10.4974V19.0053H111.323zM100.021 13.5027C100.021 16.7619 101.164 18.2434 104.847 18.2434 108.529 18.2434 109.672 16.7619 109.672 13.5027V10.4974C109.672 7.23811 108.529 5.75663 104.847 5.75663 101.164 5.75663 100.021 7.23811 100.021 10.4974v3.0053z" fill="#017efa"/><path d="M113.862 5.3756C113.862 4.99465 113.947 4.86766 114.413 4.78301L116.36 4.57137 116.656 1.14279C116.741.677185 116.868.592529 117.249.592529H117.418C117.884.592529 117.968.761841 117.968 1.14279V4.57137H123.429C124.021 4.57137 124.148 4.74068 124.148 5.29094V5.41793C124.148 5.92586 124.021 6.1375 123.429 6.1375H117.968V14.5608C117.968 17.2698 119.069 18.2856 121.101 18.2856 122.159 18.2856 123.09 18.1587 123.979 17.9047 124.444 17.7354 124.698 17.947 124.698 18.4973V18.6243C124.698 19.1322 124.529 19.3438 123.979 19.4708 123.132 19.7248 122.201 19.8518 121.143 19.8518 117.926 19.8518 116.36 18.074 116.36 14.6031V6.05285H114.413C114.032 6.05285 113.862 5.88353 113.862 5.50258V5.3756z" fill="#017efa"/><path d="M130.794 4.78311C130.794 4.95242 130.751 4.99475 130.582 4.99475H129.905V7.11115C129.905 7.32279 129.862 7.36512 129.651 7.36512H129.566C129.355 7.36512 129.312 7.32279 129.312 7.11115V4.99475H128.635C128.466 4.99475 128.423 4.95242 128.423 4.78311V4.69846C128.423 4.52914 128.466 4.48682 128.635 4.48682H130.582C130.751 4.48682 130.794 4.52914 130.794 4.69846V4.78311zM134.392 7.11115C134.392 7.32279 134.349 7.36512 134.138 7.36512H134.053C133.841 7.36512 133.799 7.32279 133.799 7.11115V4.99475L133.206 7.06883C133.164 7.28047 133.079 7.36512 132.825 7.36512 132.656 7.36512 132.529 7.28047 132.444 7.06883L131.852 4.99475V7.11115C131.852 7.32279 131.81 7.36512 131.598 7.36512H131.513C131.302 7.36512 131.259 7.32279 131.259 7.11115V4.86777C131.259 4.6138 131.386 4.48682 131.64 4.48682H131.894C132.148 4.48682 132.318 4.65613 132.402 4.95242L132.825 6.60322 133.291 4.86777C133.333 4.57147 133.503 4.48682 133.841 4.48682H133.968C134.222 4.48682 134.349 4.6138 134.349 4.86777V7.11115H134.392z" fill="#017efa"/><path d="M0 7.83057V16.1692l10.1587-4.1905L0 7.83057z" fill="#017efa"/><path d="M10.1587 11.9788 19.1323 8.33862V0L0 7.83069 10.1587 11.9788z" fill="#1239b8"/><path d="M0 16.1692l19.1323 7.8307V15.6613L10.1587 11.9788.0 16.1692z" fill="#0bbbef"/><path d="M30.0106 11.9787l10.1587 4.1905V7.83057L30.0106 11.9787z" fill="#017efa"/><path d="M40.1692 7.83069 20.9946.0V8.33862L30.0105 11.9788 40.1692 7.83069z" fill="#0bbbef"/><path d="M20.9946 15.6613v8.3386L40.1692 16.1692 30.0105 11.9788 20.9946 15.6613z" fill="#1239b8"/></g><defs><clipPath id="clip0"><rect width="134.392" height="24" fill="#fff"/></clipPath></defs></svg>
        <span class="text-uppercase font-weight-bold"></span>
      </a>
      <ul class="ondat-lp-menu">
        <li class="ondat-lp-menu-drop">
          <a href="#">Platform</a>
          <ul>
            <li><a href="#">Platform Overview</a></li>
            <li><a href="#">How it works</a></li>
          </ul>
        </li>
        <li class="ondat-lp-menu-drop">
          <a href="#">Teams</a>
          <ul>
            <li><a href="#">Development</a></li>
            <li><a href="#">DevOps SRE</a></li>
            <li><a href="#">Digital Transformation</a></li>
          </ul>
        </li>
        <li class="ondat-lp-menu-drop">
          <a href="#">Solutions</a>
          <ul>
            <li><a href="#">Stateful Apps</a></li>
            <li><a href="#">Kubernetes Distros</a></li>
          </ul>
        </li>
        <li class="ondat-lp-menu-no-drop"><a href="#">Blog</a></li>
        <li class="ondat-lp-menu-no-drop"><a href="#">Resources</a></li>
        
        <li class="ondat-lp-menu-drop">
          <a href="#">Releases</a>
          <ul>
            
            <li><a class="dropdown-item" href="/v1.x">v1.x</a></li>
            
            <li><a class="dropdown-item" href="/v2.0">v2.0</a></li>
            
            <li><a class="dropdown-item" href="/v2.1">v2.1</a></li>
            
            <li><a class="dropdown-item" href="/v2.2">v2.2</a></li>
            
            <li><a class="dropdown-item" href="/v2.3">v2.3</a></li>
            
            <li><a class="dropdown-item" href="/">v2.4</a></li>
            
          </ul>
        </li>
        
      </div>
      </ul>
    <div class="ondat-lp-header-wrapper-right">
      <a href="#" class="gs-btn">Get started for free</a>
      


<input
  type="search"
  class="form-control td-search-input"
  placeholder="Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/v1.x/offline-search-index.dd541beb70815078978276c1c1cc979a2f61de84240029223258e66acd90a4a73fad6da816c10ac3ff26f750139b40061ce1a00a8566c2934e92cf2803cf4c5a.json"
  data-offline-search-base-href="/"
>


    </div>
  </div>
</div>

<style>
  @import url("https://fonts.googleapis.com/css2?family=Open+Sans:wght@500&display=swap");

  #ondat-lp-header {
    width: 100%;
    padding: 20px 0;
    background-color: white;
    font-weight: 500;
  }

  .ondat-lp-header-wrapper {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 1240px;
    margin: auto;
  }

  .ondat-lp-header-wrapper-left {
    display: flex;
    align-items: center;
  }

  ul.ondat-lp-menu,
  ul.ondat-lp-menu li {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  ul.ondat-lp-menu {
    display: flex;
  }

  ul.ondat-lp-menu > li {
    margin-left: 48px;
  }

  li.ondat-lp-menu-drop > a {
    display: flex;
    align-items: center;
  }

  li.ondat-lp-menu-no-drop a {
    display: flex;
    align-items: center;
  }

  li.ondat-lp-menu-drop > a:after {
    display: inline-block;
    content: "";
    width: 8px;
    height: 5px;
    margin-left: 6px;
    background: url("images/drop.svg") no-repeat;
  }

  li.ondat-lp-menu-drop ul {
    display: none;
    box-shadow: 0px 10px 35px 5px rgb(50 50 50 / 15%);
    background-color: white;
    border-top: 2px solid #017efa;
    position: absolute;
    padding-left: 0;
    padding: 15px;
    margin-left: 0;
  }

  li.ondat-lp-menu-drop ul > li {
    list-style: none;
    margin-bottom: 10px;
    line-height: normal;
    font-size: 13px;
  }

  li.ondat-lp-menu-drop ul > li:last-child {
    margin-bottom: 0px;
  }

  li.ondat-lp-menu-drop ul > li > a {
    font-size: 13px !important;
    font-weight: 700 !important;
  }

  li.ondat-lp-menu-drop:hover ul {
    display: block;
  }

  li.ondat-lp-menu-drop:hover ul {
    display: block;
  }

  #ondat-lp-header a {
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
    color: #081d60;
    font-family: "Plus Jakarta Display";
  }

  .ondat-lp-header-wrapper-right {
    display: flex;
    align-items: center;
  }

  #ondat-lp-header a.gs-btn {
    color: #017efa;
    display: block;
    padding: 10px 24px;
  }

  #ondat-lp-header a.login-btn {
    color: #fff;
    font-weight: 700;
    display: block;
    padding: 10px 24px;
    background-color: #017efa;
    border-radius: 4px;
  }
</style>

    </header>
    <div class="body-search">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#td-section-nav">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    


<input
  type="search"
  class="form-control td-search-input"
  placeholder="Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/v1.x/offline-search-index.dd541beb70815078978276c1c1cc979a2f61de84240029223258e66acd90a4a73fad6da816c10ac3ff26f750139b40061ce1a00a8566c2934e92cf2803cf4c5a.json"
  data-offline-search-base-href="/"
>


  </div>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            




<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <nav class="collapse td-sidebar-nav pt-2 pl-4" id="td-section-nav">
    
    






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v1.x/docs/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Documentation V1</a>
  </li>
  <ul>
    <li class="collapse show" id="v1xdocs">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v1.x/docs/introduction/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Introduction</a>
  </li>
  <ul>
    <li class="collapse " id="v1xdocsintroduction">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsintroductionquickstart" href="/v1.x/docs/introduction/quickstart/">Quickstart</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsintroductionplatforms" href="/v1.x/docs/introduction/platforms/">Supported Platforms</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v1.x/docs/concepts/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Concepts</a>
  </li>
  <ul>
    <li class="collapse " id="v1xdocsconcepts">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsconceptsarchitecture" href="/v1.x/docs/concepts/architecture/">Architecture</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsconceptsclusters" href="/v1.x/docs/concepts/clusters/">Clusters</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsconceptscompression" href="/v1.x/docs/concepts/compression/">Compression</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsconceptsencryption" href="/v1.x/docs/concepts/encryption/">Encryption</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsconceptsfencing" href="/v1.x/docs/concepts/fencing/">Fencing</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsconceptsmetrics" href="/v1.x/docs/concepts/metrics/">Metrics</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsconceptsnamespaces" href="/v1.x/docs/concepts/namespaces/">Namespaces</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsconceptsnodes" href="/v1.x/docs/concepts/nodes/">Nodes</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsconceptspodlocality" href="/v1.x/docs/concepts/podlocality/">Podlocality</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsconceptspolicies" href="/v1.x/docs/concepts/policies/">Policies</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsconceptspools" href="/v1.x/docs/concepts/pools/">Pools</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsconceptsreplication" href="/v1.x/docs/concepts/replication/">Replication</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsconceptsrules" href="/v1.x/docs/concepts/rules/">Rules</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsconceptssharedfs" href="/v1.x/docs/concepts/sharedfs/">Shared Filesystem - RWX</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsconceptsvolumes" href="/v1.x/docs/concepts/volumes/">Volumes</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v1.x/docs/prerequisites/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Prerequisites</a>
  </li>
  <ul>
    <li class="collapse " id="v1xdocsprerequisites">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsprerequisitessystemconfiguration" href="/v1.x/docs/prerequisites/systemconfiguration/">System Configuration</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsprerequisitesfirewalls" href="/v1.x/docs/prerequisites/firewalls/">Ports and Firewall settings</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsprerequisitesmountpropagation" href="/v1.x/docs/prerequisites/mountpropagation/">Mount Propagation</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v1.x/docs/install/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Install</a>
  </li>
  <ul>
    <li class="collapse " id="v1xdocsinstall">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsinstallkubernetes" href="/v1.x/docs/install/kubernetes/">Kubernetes</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsinstallopenshift" href="/v1.x/docs/install/openshift/">OpenShift</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsinstallrancher" href="/v1.x/docs/install/rancher/">Rancher</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v1.x/docs/platforms/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Platforms</a>
  </li>
  <ul>
    <li class="collapse " id="v1xdocsplatforms">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsplatformsaws-eks" href="/v1.x/docs/platforms/aws-eks/">AWS EKS</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsplatformsazure-aks" href="/v1.x/docs/platforms/azure-aks/">Azure AKS</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsplatformsdockeree" href="/v1.x/docs/platforms/dockeree/">DockerEE</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsplatformsopenshift" href="/v1.x/docs/platforms/openshift/">OpenShift</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsplatformsrancher" href="/v1.x/docs/platforms/rancher/">Rancher</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsbest-practices" href="/v1.x/docs/best-practices/">Best Practices</a>
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v1.x/docs/operations/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Operations</a>
  </li>
  <ul>
    <li class="collapse show" id="v1xdocsoperations">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsoperationsupdates" href="/v1.x/docs/operations/updates/"></a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsoperationsdecommission-nodes" href="/v1.x/docs/operations/decommission-nodes/">Decommissioning of Nodes</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsoperationsencrypted-volumes" href="/v1.x/docs/operations/encrypted-volumes/">Encryption</a>
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v1.x/docs/operations/external-etcd/" class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Etcd</a>
  </li>
  <ul>
    <li class="collapse show" id="v1xdocsoperationsexternal-etcd">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsoperationsexternal-etcdetcd-tls" href="/v1.x/docs/operations/external-etcd/etcd-tls/">mTLS</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsoperationsfencing" href="/v1.x/docs/operations/fencing/">Fencing Pods</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsoperationsfirstpvc" href="/v1.x/docs/operations/firstpvc/">First PVC</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsoperationshealth" href="/v1.x/docs/operations/health/">Health</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsoperationsmanaging-host-storage" href="/v1.x/docs/operations/managing-host-storage/">Host Storage</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsoperationslicensing" href="/v1.x/docs/operations/licensing/">Licensing</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsoperationsmaintenance" href="/v1.x/docs/operations/maintenance/">Maintenance</a>
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v1.x/docs/operations/monitoring/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Monitoring</a>
  </li>
  <ul>
    <li class="collapse " id="v1xdocsoperationsmonitoring">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsoperationsmonitoringprometheus-setup" href="/v1.x/docs/operations/monitoring/prometheus-setup/">Prometheus Setup</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsoperationsnamespaces" href="/v1.x/docs/operations/namespaces/">Namespaces</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsoperationspolicies" href="/v1.x/docs/operations/policies/">Policies</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsoperationsovercommitment" href="/v1.x/docs/operations/overcommitment/">Pool Overcommitment</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsoperationsrules" href="/v1.x/docs/operations/rules/">Rules</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsoperationssharedfs" href="/v1.x/docs/operations/sharedfs/">Shared Filesystem - RWX</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsoperationstroubleshooting" href="/v1.x/docs/operations/troubleshooting/">Troubleshooting</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsoperationsupgrades" href="/v1.x/docs/operations/upgrades/">Upgrade Ondat</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsoperationsusers" href="/v1.x/docs/operations/users/">User Management</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v1.x/docs/usecases/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Use Cases</a>
  </li>
  <ul>
    <li class="collapse " id="v1xdocsusecases">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsusecasesbackups" href="/v1.x/docs/usecases/backups/">Backups</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsusecasescassandra" href="/v1.x/docs/usecases/cassandra/">Cassandra</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsusecaseselasticsearch" href="/v1.x/docs/usecases/elasticsearch/">Elasticsearch</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsusecasesjenkins" href="/v1.x/docs/usecases/jenkins/">Jenkins</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsusecaseskafka" href="/v1.x/docs/usecases/kafka/">Kafka</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsusecaseskubevirt" href="/v1.x/docs/usecases/kubevirt/">Kubevirt</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsusecasesmssql" href="/v1.x/docs/usecases/mssql/">MS SQL</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsusecasesmysql" href="/v1.x/docs/usecases/mysql/">MySQL</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsusecasesnginx" href="/v1.x/docs/usecases/nginx/">Nginx</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsusecasespostgres" href="/v1.x/docs/usecases/postgres/">PostgreSQL</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsusecasesredis" href="/v1.x/docs/usecases/redis/">Redis</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsusecaseszookeeper" href="/v1.x/docs/usecases/zookeeper/">Zookeeper</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v1.x/docs/reference/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Reference</a>
  </li>
  <ul>
    <li class="collapse " id="v1xdocsreference">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferenceapi" href="/v1.x/docs/reference/api/">API Reference</a>
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v1.x/docs/reference/cli/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">CLI</a>
  </li>
  <ul>
    <li class="collapse " id="v1xdocsreferencecli">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferenceclicluster" href="/v1.x/docs/reference/cli/cluster/">Cluster</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferenceclilicence" href="/v1.x/docs/reference/cli/licence/">Licence</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferenceclilogin" href="/v1.x/docs/reference/cli/login/">Login</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferenceclilogs" href="/v1.x/docs/reference/cli/logs/">Logs</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferenceclinamespace" href="/v1.x/docs/reference/cli/namespace/">Namespaces</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferenceclinode" href="/v1.x/docs/reference/cli/node/">Nodes</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferenceclipolicy" href="/v1.x/docs/reference/cli/policy/">Policies</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferenceclipool" href="/v1.x/docs/reference/cli/pool/">Pools</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferenceclirule" href="/v1.x/docs/reference/cli/rule/">Rules</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferencecliuser" href="/v1.x/docs/reference/cli/user/">Users</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferenceclivolume" href="/v1.x/docs/reference/cli/volume/">Volumes</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferenceclusterdiscovery" href="/v1.x/docs/reference/clusterdiscovery/">Cluster discovery</a>
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v1.x/docs/reference/cluster-operator/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Cluster Operator</a>
  </li>
  <ul>
    <li class="collapse " id="v1xdocsreferencecluster-operator">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferencecluster-operatorinstall" href="/v1.x/docs/reference/cluster-operator/install/">Install</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferencecluster-operatorconfiguration" href="/v1.x/docs/reference/cluster-operator/configuration/">Configuration</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferencecluster-operatorexamples" href="/v1.x/docs/reference/cluster-operator/examples/">Examples</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferencecluster-operatorupgrade" href="/v1.x/docs/reference/cluster-operator/upgrade/">Operator upgrade</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferencecontributing" href="/v1.x/docs/reference/contributing/">Contributing to the docs</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferenceenvvars" href="/v1.x/docs/reference/envvars/">Environment Variables</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferencegui" href="/v1.x/docs/reference/gui/">GUI</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferenceinit-container" href="/v1.x/docs/reference/init-container/">Init container</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferencelabels" href="/v1.x/docs/reference/labels/">Labels</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferencetelemetry" href="/v1.x/docs/reference/telemetry/">Ondat Telemetry</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferenceopen_source_attribution" href="/v1.x/docs/reference/open_source_attribution/">Open Source Attribution</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferenceprometheus" href="/v1.x/docs/reference/prometheus/">Prometheus Endpoint</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferencerelease_notes" href="/v1.x/docs/reference/release_notes/">Release notes</a>
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v1.x/docs/reference/scheduler/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Scheduler</a>
  </li>
  <ul>
    <li class="collapse " id="v1xdocsreferencescheduler">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferencescheduleradmission-controller" href="/v1.x/docs/reference/scheduler/admission-controller/">Admission Controller</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferenceschedulerexamples" href="/v1.x/docs/reference/scheduler/examples/">Examples</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsreferencefilesystems" href="/v1.x/docs/reference/filesystems/">Supported File systems</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocssupport" href="/v1.x/docs/support/">Support</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v1xdocsself-eval" href="/v1.x/docs/self-eval/">Self Evaluation Guide</a>
      
      
    </li>
  </ul>
</ul>

  </nav>
</div>




          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            











<nav id="TableOfContents">
  <ul>
    <li><a href="#installation-options">Installation options</a></li>
    <li><a href="#ondat-and-etcd">Ondat and Etcd</a></li>
    <li><a href="#best-practices">Best practices</a>
      <ul>
        <li><a href="#monitoring">Monitoring</a></li>
        <li><a href="#defragmentation">Defragmentation</a></li>
      </ul>
    </li>
  </ul>
</nav>



          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">
		










<li class="breadcrumb-item" >
	<a href="https://ondat.github.io/v1.x/docs/">Documentation V1</a>
</li>




<li class="breadcrumb-item" >
	<a href="https://ondat.github.io/v1.x/docs/operations/">Operations</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="https://ondat.github.io/v1.x/docs/operations/external-etcd/">Etcd</a>
</li>

	</ol>
</nav	>

            
<div class="td-content">
	<h1>Etcd</h1>
	
	<p>Ondat uses <a href="https://etcd.io">etcd</a> to store cluster metadata. Because of
the strong consistency model that etcd enforces, Ondat metadata operations
are guaranteed to be atomic and consistent.</p>
<h2 id="installation-options">Installation options</h2>
<p>Before installing Ondat, an etcd cluster needs to be prepared. There are
different topologies that fulfil this prerequisite.</p>
<ol>
<li>External etcd (<em>Production</em>)</li>
<li>etcd as Pods (<em>Testing</em>)</li>
</ol>
<nav>
	<div class="nav nav-tabs" id="nav-tab" role="tablist">

		
		
		
		

            
            

            
            

            

            

		<a class="nav-item nav-link active" id="nav-9" data-toggle="tab" href="#production" role="tab"
		   aria-controls="nav-home" aria-selected="true">Production</a>

            
		

            
            

            
            

            

            

		<a class="nav-item nav-link" id="nav-9" data-toggle="tab" href="#testing" role="tab"
		   aria-controls="nav-home" aria-selected="false">Testing</a>

            
		

	</div>
</nav>

<div class="tab-content" id="9">
    <br></br>








<div class="tab-pane fade show active" id="production" role="tabpanel" aria-labelledby="nav-production">
    <h2 id="external-etcd">External Etcd</h2>
<p>The production topology is designed to provide the highest stability for the
etcd cluster. It is necessary for normal Ondat function to have a reliable
metadata cluster. Otherwise, central operations such as provisioning,
attachment or failover of volumes cannot be performed. In the event that etcd
becomes unavailable, Ondat clusters become read only, allowing access to
data but preventing metadata changes.</p>
<p>It is recommended to install etcd out of the scope of the orchestrator wherever
possible. Following CoreOS best practices, a minimum of 3 independent nodes
should be dedicated to etcd. Ondat doesn&rsquo;t require a high performance etcd
cluster as the throughput of metadata to the cluster is low. Depending on the
level of redundancy you feel comfortable with you can install etcd on the
Kubernetes Master nodes. <strong>Take extreme care to avoid collisions of the
Ondat etcd installation with the Kubernetes etcd when using the Kubernetes
Master nodes. Precautions such as changing the default configuration for the
client and peer ports, and ensuring the etcd data directory is modified. The
ansible playbook below will default the etcd installation directory to
<code>/var/lib/storageos-etcd</code>.</strong></p>
<h3 id="installation">Installation</h3>
<p>If you are familiar with etcd, you can proceed with the CoreOS instructions to
install etcd, otherwise this section lays out out an example installation using
Ansible.</p>
<ol>
<li>
<p>Clone Ondat Helper repository</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git clone https://github.com/storageos/deploy.git
<span style="color:#204a87">cd</span> k8s/deploy-storageos/etcd-helpers/etcd-ansible-systemd
</code></pre></div></li>
<li>
<p>Edit the inventory file</p>
<blockquote>
<p>Target the nodes that install etcd, where the file <code>hosts.example</code> serves
as an example. The <code>ip</code> parameter is needed for each node.</p>
</blockquote>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat hosts.example
<span style="color:#ce5c00;font-weight:bold">[</span>nodes<span style="color:#ce5c00;font-weight:bold">]</span>
centos-1 <span style="color:#000">ip</span><span style="color:#ce5c00;font-weight:bold">=</span>172.28.128.14
centos-2 <span style="color:#000">ip</span><span style="color:#ce5c00;font-weight:bold">=</span>172.28.128.15
centos-3 <span style="color:#000">ip</span><span style="color:#ce5c00;font-weight:bold">=</span>172.28.128.16

<span style="color:#8f5902;font-style:italic"># Edit the inventory file</span>
$ vi hosts.example <span style="color:#8f5902;font-style:italic"># Or your own inventory file</span>
</code></pre></div></li>
<li>
<p>Edit the etcd configuration</p>
<blockquote>
<p><strong>If targeting Kubernetes Master nodes, you must change
<code>etcd_port_client</code>, <code>etcd_port_peers</code></strong></p>
</blockquote>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat group_vars/all
etcd_version: <span style="color:#4e9a06">&#34;3.3.18&#34;</span>
etcd_port_client: <span style="color:#4e9a06">&#34;2379&#34;</span>
etcd_port_peers: <span style="color:#4e9a06">&#34;2380&#34;</span>
etcd_quota_bytes: <span style="color:#0000cf;font-weight:bold">8589934592</span>  <span style="color:#8f5902;font-style:italic"># 8 GB</span>
etcd_auto_compaction_mode: <span style="color:#4e9a06">&#34;revision&#34;</span>
etcd_auto_compaction_retention: <span style="color:#4e9a06">&#34;100&#34;</span>
members: <span style="color:#4e9a06">&#34;{{ groups[&#39;nodes&#39;]  }}&#34;</span>
installation_dir: <span style="color:#4e9a06">&#34;/var/lib/storageos-etcd&#34;</span>

$ vi group_vars/all
</code></pre></div></li>
<li>
<p>Install</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ansible-playbook -i hosts.example site.yml
</code></pre></div></li>
<li>
<p>Verify installation</p>
<blockquote>
<p>The playbook installs the <code>etcdctl</code> binary on the nodes, at
<code>/usr/local/bin</code>.</p>
</blockquote>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ssh <span style="color:#000">$NODE</span> <span style="color:#8f5902;font-style:italic"># Any node running the new etcd</span>
$ <span style="color:#000">ETCDCTL_API</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">3</span> etcdctl --endpoints<span style="color:#ce5c00;font-weight:bold">=</span>127.0.0.1:2379 member list
66946cff1224bb5, started, etcd-b94bqkb9rf,  http://172.28.0.1:2380, http://172.28.0.1:2379
17e7256953f9319b, started, etcd-gjr25s4sdr, http://172.28.0.2:2380, http://172.28.0.2:2379
8b698843a4658823, started, etcd-rqdf9thx5p, http://172.28.0.3:2380, http://172.28.0.3:2379
</code></pre></div></li>
</ol>
<h2 id="managed-services">Managed Services</h2>
<p>When running Ondat on Managed Kubernetes services it may not be possible to
deploy with the Production etcd topology described above. It is therefore
recommended to deploy etcd on its own as much as possible, even if that means
deploying 3 independent VMs for etcd to run on.</p>
<p>As managed services treat nodes as ephemeral resources, if the orchestration
deletes the 3 nodes hosting etcd, the result will be catastrophic and a restore
from a backup will be needed.</p>
<p>If it is not possible to deploy independent VMs for etcd, etcd can be deployed
as pods, inside the cluster. This configuration requires an awareness of the
stability that etcd requires. <strong>You can use the <a href="https://ondat.github.io/v1.x/docs/operations/external-etcd/#installation-options">etcd-as-pods</a>
installation option, but be aware of the precautions that need to be taken.</strong></p>
<h2 id="why-external-etcd">Why External Etcd</h2>
<p>etcd is a distributed key-value store database focused on strong consistency.
That means that etcd nodes perform operations across the cluster to ensure
quorum. In the case that quorum is lost, an etcd node stops and marks its
contents as read-only. It cannot guarantee that the data being held is valid.
Another peer might have a newer version that has not been delivered. Quorum is
fundamental for etcd operations.</p>
<p>In a Kubernetes environment, applications are scheduled across and in some
scenarios such as &ldquo;DiskPressure&rdquo; they may need to be evicted from a node, and
be scheduled onto a different node. With an application such as etcd, the
scenario described can result in quorum being lost, making the cluster unable
to recover automatically. Usually a 3 node etcd cluster can survive losing one
node and recover. However, losing a second node at the same time or even having
a network partition between them will result in quorum lost.</p>
<h2 id="bind-etcd-ips-to-kubernetes-service">Bind Etcd IPs to Kubernetes Service</h2>
<p>Kubernetes external services use a DNS name to reference external endpoints.
You can use the example from the <a href="https://github.com/storageos/deploy/tree/master/k8s/deploy-storageos/etcd-helpers/etcd-external-svc">helper github
repository</a>
to deploy the external Service. That might be of use when monitoring etcd from
Prometheus.</p>

</div>









<div class="tab-pane fade" id="testing" role="tabpanel" aria-labelledby="nav-testing">
    <h2 id="etcd-as-pods">Etcd as Pods</h2>
<p>etcd can be deployed in Kubernetes using the official <a href="https://github.com/coreos/etcd-operator">etcd-operator</a>.</p>
<p>Deploying etcd in Kubernetes makes the etcd installation very easy, however be
aware that even though the official etcd-operator is maintained by RedHat, it
hasn&rsquo;t been under active development since 2019. As such it may be considered
an archived project. For an actively maintained etcd Operator you might want to
check the <a href="https://github.com/improbable-eng/etcd-cluster-operator">Improbable etcd
Operator</a>.</p>
<p>Examples of deploying etcd clusters using the etcd-operator on <a href="https://github.com/storageos/deploy/tree/master/k8s/deploy-storageos/etcd-helpers/etcd-operator-example">Kubernetes</a>
and
<a href="https://github.com/storageos/deploy/tree/master/openshift/deploy-storageos/etcd-helpers/etcd-operator-example">OpenShift</a>
are available.</p>
<p>Since Kubernetes 1.16 the deployment api uses &ldquo;apps/v1&rdquo;. Once you have cloned
the coreos etcd operator repository, you will need to change the apiVersion of
the file &ldquo;examples/deployment.yaml&rdquo; from <code>extensions/v1beta1</code> to <code>apps/v1</code>.</p>
<p>The official etcd-operator repository also has a backup deployment operator
that can help backup etcd data. Make sure you take frequent backups of the etcd
cluster as it holds all the Ondat cluster metadata.</p>
<h2 id="known-etcd-operator-issues">Known etcd-operator issues</h2>
<p>This topology is only recommended for deployments where isolated nodes cannot be
used.</p>
<p>etcd is a distributed key-value store database focused on strong consistency.
That means that etcd nodes perform operations across the cluster to ensure
quorum. If quorum is lost, etcd nodes stop and etcd marks its contents as
read-only. This is because it cannot guarantee that new data will be valid.
Quorum is fundamental for etcd operations. When running etcd in pods it is
therefore important to consider that a loss of quorum could arise from etcd
pods being evicted from nodes.</p>
<p>Operations such as Kubernetes Upgrades with rolling node pools could cause a
total failure of the etcd cluster as nodes are discarded in favor of new ones.</p>
<p>A 3 etcd node cluster can survive losing one node and recover, a 5 node cluster
can survive the loss of two nodes. Loss of further nodes will result in quorum
being lost.</p>
<p>The etcd-operator doesn&rsquo;t support a full stop of the cluster. Stopping the etcd
cluster is not possible unless a backup is restored.</p>

</div>






</div>

<h2 id="ondat-and-etcd">Ondat and Etcd</h2>
<p>When installing Ondat, the etcd endpoints are passed in a StorageOSCluster Custom
Resource.</p>
<p>For instance:</p>
<pre><code>apiVersion: &quot;storageos.com/v1&quot;
kind: StorageOSCluster
metadata:
  name: &quot;storageos&quot;
spec:
  secretRefName: &quot;storageos-api&quot; # Reference from the Secret created in the previous step
  secretRefNamespace: &quot;default&quot;  # Namespace of the Secret

  (...)

  kvBackend:
    address: 'storageos-etcd-client.etcd:2379' # Example address, change for your etcd endpoint
   #address: '10.42.15.23:2379,10.42.12.22:2379,10.42.13.16:2379' # You can set etcd server ips
    backend: 'etcd'
</code></pre><blockquote>
<p>Note the <code>kvBackend.address</code> section.</p>
</blockquote>
<p>For full Custom Resource documentation check <a href="/docs/reference/cluster-operator/configuration">StorageOSCluster resource definition</a>.</p>
<h2 id="best-practices">Best practices</h2>
<p>Ondat uses etcd as a service, whether it is deployed following the above
instructions or as a custom installation. It is expected that the user
maintains the availability and integrity of the etcd cluster.</p>
<p>It is highly recommended to keep the cluster backed up and ensure high
availability of its data. It is also important to keep the latency between
Ondat nodes and the etcd replicas low. Deploying an etcd cluster in a
different data center or region can make Ondat detect etcd nodes as
unavailable due to latency. A 10ms latency between Ondat and etcd would be
the maximum threshold for proper functioning of the system.</p>
<h3 id="monitoring">Monitoring</h3>
<p>It is highly recommended to add monitoring to the etcd cluster. etcd serves
Prometheus metrics on the client port <code>http://etc-url:2379/metrics</code>.</p>
<p>You can use Ondat developed Grafana Dashboards for etcd. When using etcd
for production, you can use the
<a href="https://grafana.com/grafana/dashboards/10322">etcd-cluster-as-service</a>, while
the <a href="https://grafana.com/grafana/dashboards/10323">etcd-cluster-as-pod</a> can be
used when using etcd from the operator.</p>
<h3 id="defragmentation">Defragmentation</h3>
<p>etcd uses revisions to store multiple versions of keys. Compaction removes all
key revision prior to a certain revision from etcd. Typically the etcd
configuration enables the automatic compaction of keys to prevent performance
degradation and limit the storage required. Compaction of revisions can create
fragmentation that means space on disk is available for use by etcd but is
unavailable for use by the file system. In order to reclaim this space, etcd
can be defragmented.</p>
<p>Reclaiming space is important because when the etcd database file grows over
the &ldquo;DB_BACKEND_BYTES&rdquo; parameter, the cluster triggers an alarm and sets itself
read only and only allows reads and deletes. To avoid hitting the db backend
bytes limit, compaction and defragmentation are required. How often
defragmentation is required depends on the churn of key revisions in etcd.</p>
<p>The Grafana Dashboards mentioned above indicate when nodes require
defragmentation. Be aware that defragmentation is a blocking operation that is
performed per node, hence the etcd node will be locked for the duration of the
defragmentation. Defragmentation usually takes a few milliseconds to complete.</p>

        <div class="section-index">
    
    
    
    
    <hr class="panel-line">
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
                <div class="entry">
                    <h5>
                        <a href="/v1.x/docs/operations/external-etcd/etcd-tls/">Encrypting communication with Etcd</a>
                    </h5>
                    <p></p>
                </div>
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
</div>

	
	
	<div class="text-muted mt-5 pt-3 border-top"></div>
</div>

          </main>
        </div>
      </div>

    </div>
    <div id="ondat-lp-footer">
  <div class="ondat-lp-footer-wrapper">
    <div class="ondat-lp-footer-wrapper-left">
      <a class="navbar-brand" href="https://storageos.com">
        <svg width="135" height="24" viewBox="0 0 135 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)"><path d="M48.8466 13.2064V10.5821C48.8466 6.30695 51.1323 4.02124 55.8307 4.02124 60.6561 4.02124 62.7725 6.2223 62.7725 10.5821v2.6243C62.7725 17.4392 60.4868 19.7673 55.8307 19.7673 50.963 19.8096 48.8466 17.6085 48.8466 13.2064zM59.6826 10.5821C59.6826 8.0424 58.836 6.94188 55.8731 6.94188 52.9101 6.94188 52.0212 8.0424 52.0212 10.5821v2.6243C52.0212 15.7461 52.8678 16.8466 55.8731 16.8466 58.836 16.8466 59.6826 15.7884 59.6826 13.2064V10.5821z" fill="#1239b8"/><path d="M68.91 18.074C68.91 19.1745 68.6561 19.4285 67.5555 19.4285H67.1746C66.074 19.4285 65.8201 19.1745 65.8201 18.074V9.90469C65.8201 5.96818 68.0635 3.97876 72.4656 3.97876 77.0793 3.97876 79.0687 5.96818 79.0687 9.90469V18.074C79.0687 19.1745 78.8148 19.4285 77.7143 19.4285H77.3333C76.2328 19.4285 75.9788 19.1745 75.9788 18.074V9.90469C75.9788 7.83061 75.2169 6.94172 72.5079 6.94172 69.7989 6.94172 68.9947 7.87294 68.9947 9.90469V18.074H68.91z" fill="#1239b8"/><path d="M95.1534 13.5026C95.1534 17.6931 92.9947 19.7248 88.6772 19.7248 84.1481 19.7248 82.2433 17.5237 82.2433 13.5026V10.5396C82.2433 6.47613 84.0211 4.27507 88.5079 4.27507 91.0476 4.27507 92.6984 5.0793 93.4603 6.73009V1.31211C93.4603.719513 93.6296.592529 94.1799.592529H94.3492C94.9418.592529 95.0687.761841 95.0687 1.31211V13.5026H95.1534zM83.8941 13.5026C83.8941 16.7618 85.037 18.2433 88.7195 18.2433 92.3598 18.2433 93.5449 16.7618 93.5449 13.5026V10.4973C93.5449 7.23803 92.4021 5.75655 88.7195 5.75655 85.0793 5.75655 83.8941 7.23803 83.8941 10.4973v3.0053z" fill="#017efa"/><path d="M111.323 19.0053C111.323 19.5979 111.153 19.7249 110.603 19.7249H110.434C109.841 19.7249 109.714 19.5556 109.714 19.0053V17.3122C108.952 18.9207 107.259 19.7672 104.762 19.7672 100.275 19.7672 98.4974 17.5238 98.4974 13.5027V10.4974C98.4974 6.43388 100.317 4.27515 104.931 4.27515 109.206 4.27515 111.407 6.34922 111.407 10.4974V19.0053H111.323zM100.021 13.5027C100.021 16.7619 101.164 18.2434 104.847 18.2434 108.529 18.2434 109.672 16.7619 109.672 13.5027V10.4974C109.672 7.23811 108.529 5.75663 104.847 5.75663 101.164 5.75663 100.021 7.23811 100.021 10.4974v3.0053z" fill="#017efa"/><path d="M113.862 5.3756C113.862 4.99465 113.947 4.86766 114.413 4.78301L116.36 4.57137 116.656 1.14279C116.741.677185 116.868.592529 117.249.592529H117.418C117.884.592529 117.968.761841 117.968 1.14279V4.57137H123.429C124.021 4.57137 124.148 4.74068 124.148 5.29094V5.41793C124.148 5.92586 124.021 6.1375 123.429 6.1375H117.968V14.5608C117.968 17.2698 119.069 18.2856 121.101 18.2856 122.159 18.2856 123.09 18.1587 123.979 17.9047 124.444 17.7354 124.698 17.947 124.698 18.4973V18.6243C124.698 19.1322 124.529 19.3438 123.979 19.4708 123.132 19.7248 122.201 19.8518 121.143 19.8518 117.926 19.8518 116.36 18.074 116.36 14.6031V6.05285H114.413C114.032 6.05285 113.862 5.88353 113.862 5.50258V5.3756z" fill="#017efa"/><path d="M130.794 4.78311C130.794 4.95242 130.751 4.99475 130.582 4.99475H129.905V7.11115C129.905 7.32279 129.862 7.36512 129.651 7.36512H129.566C129.355 7.36512 129.312 7.32279 129.312 7.11115V4.99475H128.635C128.466 4.99475 128.423 4.95242 128.423 4.78311V4.69846C128.423 4.52914 128.466 4.48682 128.635 4.48682H130.582C130.751 4.48682 130.794 4.52914 130.794 4.69846V4.78311zM134.392 7.11115C134.392 7.32279 134.349 7.36512 134.138 7.36512H134.053C133.841 7.36512 133.799 7.32279 133.799 7.11115V4.99475L133.206 7.06883C133.164 7.28047 133.079 7.36512 132.825 7.36512 132.656 7.36512 132.529 7.28047 132.444 7.06883L131.852 4.99475V7.11115C131.852 7.32279 131.81 7.36512 131.598 7.36512H131.513C131.302 7.36512 131.259 7.32279 131.259 7.11115V4.86777C131.259 4.6138 131.386 4.48682 131.64 4.48682H131.894C132.148 4.48682 132.318 4.65613 132.402 4.95242L132.825 6.60322 133.291 4.86777C133.333 4.57147 133.503 4.48682 133.841 4.48682H133.968C134.222 4.48682 134.349 4.6138 134.349 4.86777V7.11115H134.392z" fill="#017efa"/><path d="M0 7.83057V16.1692l10.1587-4.1905L0 7.83057z" fill="#017efa"/><path d="M10.1587 11.9788 19.1323 8.33862V0L0 7.83069 10.1587 11.9788z" fill="#1239b8"/><path d="M0 16.1692l19.1323 7.8307V15.6613L10.1587 11.9788.0 16.1692z" fill="#0bbbef"/><path d="M30.0106 11.9787l10.1587 4.1905V7.83057L30.0106 11.9787z" fill="#017efa"/><path d="M40.1692 7.83069 20.9946.0V8.33862L30.0105 11.9788 40.1692 7.83069z" fill="#0bbbef"/><path d="M20.9946 15.6613v8.3386L40.1692 16.1692 30.0105 11.9788 20.9946 15.6613z" fill="#1239b8"/></g><defs><clipPath id="clip0"><rect width="134.392" height="24" fill="#fff"/></clipPath></defs></svg>
        <span class="text-uppercase font-weight-bold"></span>
      </a>
      <ul>
        <li class="ondat-lp-footer-header">Platform</li>
        <li><a href="#">Overview</a></li>
        <li><a href="#">How It Works</a></li>
      </ul>
      <ul>
        <li class="ondat-lp-footer-header">Teams</li>
        <li><a href="#">Developement</a></li>
        <li><a href="#">DevOps & SRE</a></li>
      </ul>
      <ul>
        <li class="ondat-lp-footer-header">Solutions</li>
        <li><a href="#">Stateful Apps</a></li>
        <li><a href="#">Kubernetes Distros</a></li>
      </ul>
      <ul>
        <li class="ondat-lp-footer-header">Blog</li>
      </ul>
      <ul>
        <li class="ondat-lp-footer-header">Contact Us</li>
      </ul>
    </div>
    <div class="ondat-lp-footer-wrapper-right"></div>
  </div>
</div>

<style>
  @import url("https://fonts.googleapis.com/css2?family=Open+Sans:wght@500&display=swap");
  #ondat-lp-footer {
    background-color: #f8f9ff;
    padding: 120px 0;
  }
  .ondat-lp-footer-wrapper {
    max-width: 1240px;
    margin: auto;
    display: flex;
  }
  .ondat-lp-footer-wrapper-left {
    display: flex;
  }

  .ondat-lp-footer-wrapper-left ul,
  .ondat-lp-footer-wrapper-left ul li {
    list-style: none;
    margin: 0;
    padding: 0;
  }
  .ondat-lp-footer-wrapper-left ul {
    margin-left: 60px;
  }
  .ondat-lp-footer-wrapper-left ul li a {
    text-decoration: none;
    color: #5e6a8e;
    font-weight: 400;
    font-size: 12px;
    margin-top: 18px;
    display: block;
  }
  .ondat-lp-footer-wrapper-left ul li.ondat-lp-footer-header {
    font-weight: 700;
    font-size: 14px;
    color: #081d60;
  }
  .ondat-lp-footer-wrapper-right {
  }
</style>

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>









<script src="/v1.x/js/main.min.07381cb6406f1d15281f85a6dea05a3c2e9460f063c7e8dcc39b41f18db3aad0.js" integrity="sha256-BzgctkBvHRUoH4Wm3qBaPC6UYPBjx&#43;jcw5tB8Y2zqtA=" crossorigin="anonymous"></script>


<script type="text/javascript"
	  id="hs-script-loader"
	  async
	  defer
	  src="//js.hs-scripts.com/3402546.js"></script>



  </body>
</html>
